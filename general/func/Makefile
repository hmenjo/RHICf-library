#####################################################################

#-------------------------------------------------------------------
INC_DIR       = ./include
SRC_DIR       = ./src
LIB_DIR       = $(PWD)/lib
DICTINC_DIR   = ../dict/include
SCINC_DIR     = ../sc/include
#-------------------------------------------------------------------

LIBNAME          = libLHCfFunction

LIBFUNCTION_HLIST   =  A1Cal1ToCal2.h
LIBFUNCTION_HLISTS  =  $(INC_DIR)/A1Cal1ToCal2.h
LIBFUNCTION_LIBS    =  $(SRC_DIR)/A1Cal1ToCal2.o 
LIBFUNCTION_HLIST  +=  A1GainCalibration.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/A1GainCalibration.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/A1GainCalibration.o
LIBFUNCTION_HLIST  +=  A1PedeSubtract.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/A1PedeSubtract.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/A1PedeSubtract.o
LIBFUNCTION_HLIST  +=  A1RawToCal1.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/A1RawToCal1.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/A1RawToCal1.o
LIBFUNCTION_HLIST  +=  A1CrossTalk.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/A1CrossTalk.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/A1CrossTalk.o
LIBFUNCTION_HLIST  +=  A1LHCCrossTalk.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/A1LHCCrossTalk.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/A1LHCCrossTalk.o
LIBFUNCTION_HLIST  +=  A2Cal1ToCal2.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/A2Cal1ToCal2.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/A2Cal1ToCal2.o
LIBFUNCTION_HLIST  +=  A2GainCalibration.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/A2GainCalibration.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/A2GainCalibration.o
LIBFUNCTION_HLIST  +=  A2PedeSubtract.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/A2PedeSubtract.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/A2PedeSubtract.o
LIBFUNCTION_HLIST  +=  A2RawToCal1.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/A2RawToCal1.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/A2RawToCal1.o
LIBFUNCTION_HLIST  +=  A2RawToCal1Silicon.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/A2RawToCal1Silicon.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/A2RawToCal1Silicon.o
LIBFUNCTION_HLIST  +=  ADCRange.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/ADCRange.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/ADCRange.o
LIBFUNCTION_HLIST  +=  Arm2Alignment.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/Arm2Alignment.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/Arm2Alignment.o
LIBFUNCTION_HLIST  +=  ConParticleDefine.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/ConParticleDefine.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/ConParticleDefine.o
LIBFUNCTION_HLIST  +=  ConScifiPosition.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/ConScifiPosition.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/ConScifiPosition.o
LIBFUNCTION_HLIST  +=  ConShowerLeakage.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/ConShowerLeakage.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/ConShowerLeakage.o
LIBFUNCTION_HLIST  +=  FCGain.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/FCGain.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/FCGain.o
LIBFUNCTION_HLIST  +=  FuncForLHC.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/FuncForLHC.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/FuncForLHC.o
LIBFUNCTION_HLIST  +=  LHCfRunInfoTable.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/LHCfRunInfoTable.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/LHCfRunInfoTable.o
LIBFUNCTION_HLIST  +=  MyFunction.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/MyFunction.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/MyFunction.o
LIBFUNCTION_HLIST  +=  PMTGain.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/PMTGain.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/PMTGain.o
LIBFUNCTION_HLIST  +=  PMTSatu.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/PMTSatu.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/PMTSatu.o
LIBFUNCTION_HLIST  +=  PMTSatuCorrection.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/PMTSatuCorrection.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/PMTSatuCorrection.o
LIBFUNCTION_HLIST  +=  ParticleID01.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/ParticleID01.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/ParticleID01.o
LIBFUNCTION_HLIST  +=  ParticleID02.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/ParticleID02.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/ParticleID02.o
LIBFUNCTION_HLIST  +=  SciFiPosCalculation.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/SciFiPosCalculation.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/SciFiPosCalculation.o
LIBFUNCTION_HLIST  +=  ScifiGain.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/ScifiGain.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/ScifiGain.o
LIBFUNCTION_HLIST  +=  ScifiIncidentPosition02.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/ScifiIncidentPosition02.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/ScifiIncidentPosition02.o
LIBFUNCTION_HLIST  +=  ScifiPosTable.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/ScifiPosTable.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/ScifiPosTable.o
LIBFUNCTION_HLIST  +=  ScintiPosDependence.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/ScintiPosDependence.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/ScintiPosDependence.o
LIBFUNCTION_HLIST  +=  SiliconGain.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/SiliconGain.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/SiliconGain.o
LIBFUNCTION_HLIST  +=  SPSAdamoPedeSubtract.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/SPSAdamoPedeSubtract.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/SPSAdamoPedeSubtract.o
LIBFUNCTION_HLIST  +=  TransitionFit.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/TransitionFit.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/TransitionFit.o

#For RHICf
LIBFUNCTION_HLIST  +=  RHICfRunInfoTable.h
LIBFUNCTION_HLISTS +=  $(INC_DIR)/RHICfRunInfoTable.h
LIBFUNCTION_LIBS   +=  $(SRC_DIR)/RHICfRunInfoTable.o

LIBFUNCTION_LIBS   +=  $(SRC_DIR)/$(LIBNAME).o 

INCALL += -I$(INC_DIR) -I$(DICTINC_DIR) -I$(SCINC_DIR)

#------------------------------------------------
#
# Configuration for each architecture
# (Updated for  ROOT version > 5.32)

MAKEARCH        :=      $(shell find $(ROOTSYS)/test -name Makefile.arch)
ifeq ($(MAKEARCH), )
# 41594 or later
MAKEARCH        :=      $(shell find $(ROOTSYS)/etc -name Makefile.arch)
endif

include $(MAKEARCH)

# For MAC OS X users
#ifeq ($(ARCH),macosx)
ifneq (,$(filter $(ARCH),macosx macosx64))
SOFLAGS  += -install_name $(LIB_DIR)/$(LIBNAME).so
endif

#-------------------------------------------------

CXXFLAGS += -DCOMPILEDIR=\"$(PWD)\"
CXXFLAGS += $(INCALL)

all: dict

$(SRC_DIR)/ParticleID02.o : $(INC_DIR)/ParticleID01.h

$(SRC_DIR)/%.o	:  $(SRC_DIR)/%.cpp  $(INC_DIR)/%.h
	$(CXX) $(CXXFLAGS) -c $< -o $@

$(SRC_DIR)/%.o	:  $(SRC_DIR)/%.cpp  
	$(CXX) $(CXXFLAGS)  -c $< -o $@

$(INC_DIR)/$(LIBNAME).h : $(LIBFUNCTION_HLISTS) $(INC_DIR)/LinkDef.h
	rootcint -f $(LIBNAME).cpp -c -I$(INC_DIR) -I$(SRC_DIR) \
	-I$(DICTINC_DIR) -I$(SCINC_DIR) \
	$(LIBFUNCTION_HLIST) $(INC_DIR)/LinkDef.h
	mv $(LIBNAME).h $(INC_DIR)/
	mv $(LIBNAME).cpp $(SRC_DIR)/

$(SRC_DIR)/$(LIBNAME).o :  $(INC_DIR)/$(LIBNAME).h
	$(CXX) $(CXXFLAGS) -c $(SRC_DIR)/$(LIBNAME).cpp -o $@

$(LIB_DIR)/$(LIBNAME).so : $(LIBFUNCTION_LIBS)
	$(LD) $(LDFLAGS) $(SOFLAGS) $^ -o $@ $(EXPLLINKLIBS) \
	-L../dict/lib -lLHCfEvent

dict: 	$(LIB_DIR)/$(LIBNAME).so

$(INC_DIR)/%.h :

clean:
	rm -f $(INC_DIR)/*~ $(SRC_DIR)/*~
	rm -f $(INC_DIR)/$(LIBNAME).h
	rm -f $(SRC_DIR)/$(LIBNAME).cpp
	rm -f $(LIBFUNCTION_LIBS)
	rm -f $(LIB_DIR)/$(LIBNAME).so
